!function(e,$){"use strict";var t={activeElement:void 0,lastActive:void 0,stackedElements:[],tabbableElements:"a[href], area[href], input:not([disabled]),select:not([disabled]), textarea:not([disabled]),button:not([disabled]), iframe, object, embed, *[tabindex],*[contenteditable]",on:function(e,t,n){var a=0;if("string"!=typeof e)throw new Error("Type error: `event` has to be a string");if("function"!=typeof n)throw new Error("Type error: `callback` has to be a function");if(t)for(t.length||(t=[t]);a<t.length;a++)$?$(t[a]).on(e,n):"addEventListener"in t[a]&&t[a].addEventListener(e,n,!1)},trigger:function(e,t){var n,a={detail:{modal:t}};$?$(document).trigger(e,a):document.createEvent?(n=document.createEvent("CustomEvent"),n.initCustomEvent(e,!1,!1,{modal:t}),document.dispatchEvent(n)):(n=new CustomEvent(e,a),document.dispatchEvent(n))},addClass:function(e,t){e&&!e.className.match(t)&&(e.className+=" "+t)},removeClass:function(e,t){e.className=e.className.replace(t,"").replace("  "," ")},hasClass:function(e,t){return!!e.className.match(t)},setFocus:function(){t.activeElement&&(t.lastActive=document.activeElement,t.activeElement.focus(),t.keepFocus(t.activeElement))},removeFocus:function(){t.lastActive&&t.lastActive.focus()},keepFocus:function(e){var n=[];try{n=e.querySelectorAll(t.tabbableElements)}catch(a){return}var i=t.getFirstElementVisible(n),o=t.getLastElementVisible(n),l=function(e){var t=e.which||e.keyCode;9===t&&(e.preventDefault=e.preventDefault||function(){e.returnValue=!1},e.target!==o||e.shiftKey?e.target===i&&e.shiftKey&&(e.preventDefault(),o.focus()):(e.preventDefault(),i.focus()))};t.on("keydown",e,l)},getFirstElementVisible:function(e){var n=e.length;if(t.isElementVisible(e[0]))return e[0];for(var a=1;n-1>a;a++)if(t.isElementVisible(e[a]))return e[a];return null},getLastElementVisible:function(e){var n=e.length,a=e[n-1];if(t.isElementVisible(a))return a;for(var i=n-1;i>=0;i--)if(t.isElementVisible(e[i]))return e[i];return null},isElementVisible:function(e){return!(0===e.offsetWidth&&0===e.offsetHeight)},setActive:function(e){t.addClass(e,"is-active"),t.activeElement=e,t.activeElement.setAttribute("aria-hidden","false"),t.setFocus(e.id),t.trigger("cssmodal:show",t.activeElement)},unsetActive:function(e,n){t.removeClass(document.documentElement,"has-overlay"),t.activeElement&&(t.removeClass(t.activeElement,"is-active"),t.trigger("cssmodal:hide",t.activeElement),t.activeElement.setAttribute("aria-hidden","true"),t.removeFocus(),e&&!n&&t.stackModal(t.activeElement),!e&&t.stackedElements.length>0&&t.unstackModal(),t.activeElement=null)},stackModal:function(e){t.addClass(e,"is-stacked"),t.stackedElements.push(t.activeElement)},unstackModal:function(){var n=t.stackedElements.length,a=t.stackedElements[n-1];t.removeClass(a,"is-stacked"),e.location.hash=a.id,t.stackedElements.splice(n-1,1)},mainHandler:function(n,a){var i=e.location.hash.replace("#",""),o=0,l=[],s,c;if(a&&(i=n.currentTarget.getAttribute("href").replace("#","")),s=document.getElementById(i),-1!==i.indexOf("/")){if(l=i.split("/"),o=l.pop(),i=l.join("/"),s=document.getElementById(i),!s)throw new Error('ReferenceError: element "'+i+'" does not exist!');s.index=1*o}if(s){try{n.preventDefault()}catch(r){n.returnValue=!1}c=s.children[0],c&&c.className.match(/modal-inner/)&&(t.unsetActive(!t.hasClass(s,"is-active"),"false"===s.getAttribute("data-stackable")),t.addClass(document.documentElement,"has-overlay"),t._currentScrollPositionY=e.scrollY,t._currentScrollPositionX=e.scrollX,t.setActive(s),t.activeElement._noHash=a)}else t.unsetActive();return!0},injectIframes:function(){for(var e=document.querySelectorAll("[data-iframe-src]"),t,n=0;n<e.length;n++)t=document.createElement("iframe"),t.src=e[n].getAttribute("data-iframe-src"),t.setAttribute("webkitallowfullscreen",!0),t.setAttribute("mozallowfullscreen",!0),t.setAttribute("allowfullscreen",!0),e[n].appendChild(t)},init:function(){this.on("keyup",document,function(n){var a=e.location.hash.replace("#","");if(27===n.keyCode){if(t.activeElement&&a===t.activeElement.id?e.location.hash="!":t.unsetActive(),t.lastActive)return!1;t.removeFocus()}},!1),this.on("click",document.querySelectorAll("[data-cssmodal-nohash]"),function(e){t.mainHandler(e,!0)}),this.on("click",document.querySelectorAll(".modal-close"),function(e){t.activeElement._noHash&&t.mainHandler(e,!0)}),this.on("hashchange",e,t.mainHandler),this.on("load",e,t.mainHandler),e.onscroll=e.onmousewheel=function(){document.documentElement.className.match(/has-overlay/)&&e.scrollTo(t._currentScrollPositionX,t._currentScrollPositionY)},t.injectIframes()}};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=t:"function"==typeof define&&define.amd?define("CSSModal",[],function(){if(!e.CustomEvent&&!$)throw new Error("This browser doesn't support CustomEvent - please include jQuery.");return t.init(),t}):"object"==typeof e&&"object"==typeof e.document&&(e.CSSModal=t,t.init())}(window,window.jQuery);